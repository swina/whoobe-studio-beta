(("undefined"!==typeof self?self:this)["webpackJsonpWhoobeStore"]=("undefined"!==typeof self?self:this)["webpackJsonpWhoobeStore"]||[]).push([[13],{7204:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mr-20"},[t._m(0),i("div",{staticClass:"absolute right-0 top-0 m-1 mr-20 text-sm"},[t._v(" New collection "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.new_collection,expression:"new_collection"}],attrs:{type:"text",placeholder:"name of the new collection"},domProps:{value:t.new_collection},on:{input:function(e){e.target.composing||(t.new_collection=e.target.value)}}}),i("button",{staticClass:"ml-2",on:{click:t.createCollection}},[t._v("Create")])]),i("div",{staticClass:"grid grid-cols-2 text-sm"},[t.collections?i("div",{staticClass:"flex flex-col relative"},[t._l(t.collections,(function(e){return[i("div",{staticClass:"flex flex-row w-1/2 border-b justify-between"},[t._v(" "+t._s(e.collection)+" "),i("div",{staticClass:"relative",on:{click:function(i){t.current=e}}},[i("input",{staticClass:"btn absolute top-0 left-0 right-0 bottom-0 opacity-0",attrs:{type:"file",id:e._id},on:{change:t.loadTextFromFile}}),i("button",{staticClass:"h-full"},[t._v("Import data")]),t.loading?i("span",[t._v("Loading data ... please wait")]):t._e()])])]})),t.modal?i("moka-modal",{on:{close:function(e){t.modal=!t.modal},click_0:function(e){t.modal=!t.modal},click_1:t.saveFields}},[i("div",{attrs:{slot:"title"},slot:"title"},[t._v("Import data - "+t._s(t.data.data.length-1)+" records found!")]),i("div",{staticClass:"grid grid-cols-2 p-4",attrs:{slot:"content"},slot:"content"},[t.data?i("div",{staticClass:"flex flex-col"},[t._v(" Import Fields "),i("select",{directives:[{name:"model",rawName:"v-model",value:t.field,expression:"field"}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.field=e.target.multiple?i:i[0]}}},[t._l(t.data.meta,(function(e){return[i("option",{domProps:{value:e}},[t._v(t._s(e))])]}))],2),t.field&&t.data.data?i("div",[i("div",{staticClass:"text-xs text-gray-500"},[t._v("First row: "+t._s(t.field)+" => "+t._s(t.data.data[1][t.field])+" ")]),t._v(" "),i("button",{on:{click:function(e){return t.fields.push(t.field)}}},[t._v("Import field")])]):t._e(),t.importing?i("div",[t._v("Importing record "+t._s(t.importing)+" of "+t._s(t.data.data.length-1))]):t._e(),t.errors?i("div",[t._v("Errors: "+t._s(t.error))]):t._e()]):t._e(),t.fields.length?i("div",[t._v(" Following fields will be imported "),i("draggable",[t._l(t.fields,(function(e,o){return[i("div",{staticClass:"grid grid-cols-2 border mb-1 p-1 text-xs items-center"},[i("div",[t._v(t._s(e))]),i("div",{staticClass:"justify-end"},[i("i",{staticClass:"material-icons text-sm",on:{click:function(e){return t.fields.splice(o,1)}}},[t._v("delete")])])])]}))],2)],1):t._e()])]):t._e()],2):t._e()])])},l=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"text-sm pmr-20"},[i("h5",[t._v("Registered collections")]),t._v(" Collections are a way to create your own datasets in the system and importing external data."),i("br"),t._v(" Any registered collection will be available in whoobe to create content based on collection data. ")])}],n=(i("7db0"),i("159b"),i("b76a")),a=i.n(n),s={name:"MokaCollections",components:{draggable:a.a},data:function(){return{collections:null,current:null,new_collection:"",key:"0299ka@@as000122212",data:null,meta:null,loading:!1,field:null,fields:[],modal:!1,importing:0,errors:[],error:0}},mounted:function(){var t=this;this.$api.service("collections").find().then((function(e){t.collections=e.data}))},methods:{getData:function(t){this.current=this.$api.service("collection/"+t).find().then((function(t){console.log(t.data)}))},createCollection:function(){var t=this,e={collection:this.new_collection,key:this.key};this.$api.service("collections").create(e).then((function(e){t.collections.push(e)}))},loadTextFromFile:function(t){var e=t.target.files[0],i=new FileReader;i.readAsText(e);var o=this;i.onload=function(){o.data=o.$csvjson(i.result,";"),o.modal=!0}},saveFields:function(){var t=this;this.current["fields"]=this.fields,console.log(this.current),this.$api.service("collections").patch(this.current._id,this.current).then((function(e){console.log(e);var i=t.data.data;i.forEach((function(e){var i={};t.fields.forEach((function(t){i[t]=e[t]})),t.$api.service("datastore/"+t.current.collection).create(i).then((function(e){t.importing++})).catch((function(e){t.errors.push(i),t.error++}))}))}))}}},c=s,r=i("2877"),d=Object(r["a"])(c,o,l,!1,null,null,null);e["default"]=d.exports}}]);